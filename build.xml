<project name="JSPWiki" default="compile" basedir=".">

  <property name="code.src" value="src" />
  <property name="code.build" value ="build" />

  <property name="tmpdir" value="${java.io.tmpdir}/${user.name}/${ant.project.name}" />

  <property name="report.dir" value="reports" />

  <property name="tests.src" value="tests" />
  <property name="tests.build" value="tests/build" />
  <property name="tests.reports" value="tests/reports" />
  
  <path id="path.base">
     <pathelement path="${code.build}" />
     <fileset dir="lib">
        <include name="*.jar" />
     </fileset>
  </path>

  <path id="path.tests">
      <pathelement path="${tests.src}/etc" />
      <path refid="path.base" />
  </path>

  <target name="init">
     <mkdir dir="${code.build}" />
     <mkdir dir="${tests.build}" />
     <mkdir dir="${tests.reports}" />
  </target>

  <target name="compile" depends="init">
    <javac srcdir="${code.src}"
           destdir="${code.build}">
      <classpath refid="path.base" />
    </javac>
  </target>

  <target name="clean">
  </target>

  <target name="compiletests">
    <javac srcdir="${tests.src}"
           destdir="${tests.build}">
      <classpath refid="path.base" />
    </javac>
  </target>

  <target name="war" depends="compile">

    <property name="install.fulldir" value="${tmpdir}" />

    <mkdir dir="${install.fulldir}" />

    <war warfile="${install.fulldir}/${ant.project.name}.war"
         webxml="${code.src}/webdocs/WEB-INF/web.xml">
       <lib dir="lib" includes="*.jar" />
       <classes dir="${code.build}" includes="**/*.class" />
       <fileset dir="${code.src}/webdocs" includes="**" />
       <webinf dir="etc" includes="**" />
    </war>

  </target>



  <target name="tests" depends="compile,compiletests">
    <junit printsummary="yes" haltonfailure="no" fork="no">
        <classpath>
           <path refid="path.tests" />
           <pathelement path="${tests.build}" />
           <pathelement path="${java.class.path}" />
        </classpath>
        <formatter type="plain" />
        <batchtest todir="${tests.reports}">
           <fileset dir="${tests.src}">
                <include name="**/*Test.java" />
                <exclude name="**/AllTest*java" />
           </fileset>
        </batchtest>
     </junit>
  </target>

</project>
